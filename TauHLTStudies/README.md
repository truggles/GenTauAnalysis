# HPS Study Eff Alignment:

Get py cfg of entire HLT menu.  Do this from lxplus or the timing PCs.
```
hltGetConfiguration /users/tstreble/CMSSW_9_2_14/HLT_HPS/V13 --full --offline --mc --unprescale --process TAUHLT --globaltag auto:run2_mc_GRun --setup /dev/CMSSW_9_2_0/GRun > hps_cfg_strebler_v13_hlt.py
```
Original output: /afs/cern.ch/work/t/truggles/hpsAtHLT/jan14_strebler_v13/hps_cfg_strebler_v13_hlt.py

The output file from hltGetConfiguration must be edited slightly to run via crab.  Please see the diff file here: ./hpsTest/official_diff_from_hltGetConfiguration.txt to see the necessary edits.





# Running on miniAOD data via Crab
Added DCS lumi-mask: /afs/cern.ch/cms/CAF/CMSCOMM/COMM_DQM/certification/Collisions17/13TeV/DCSOnly/json_DCSONLY.txt
Using runs from https://twiki.cern.ch/twiki/bin/viewauth/CMS/PdmV2017Analysis case-2 - HV=200 7 July 2017

Make sure that the run list if updated if you want to add any "config.Data.runRange"

```
cd test
python submit_crab_data_cfg.py
```




# Current Running Local

Only ttbar sample is working
Make sure output file name from first part aligns with input file name for second
And, set pythontauHLTStudies.py setSourceFiles & customizeInput to use the ttbar files

```
cmsRun python/rerunningHLT_local_cfg.py
cmsRun python/finalStep_cfg.py
```


# Datasets used

Dataset: /TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/PhaseIFall16DR-FlatPU28to62HcalNZSRAW_90X_upgrade2017_realistic_v6_C1-v2/AODSIM

Dataset: /TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/PhaseIFall16DR-FlatPU28to62HcalNZSRAW_90X_upgrade2017_realistic_v6_C1-v2/GEN-SIM-RAW

GluGluHiggsTauTau isn't working
dataset=/VBFHToTauTau_M125_13TeV_powheg_pythia8/PhaseIFall16DR-FlatPU28to62HcalNZSRAW_90X_upgrade2017_realistic_v6_C1-v1/GEN-SIM-RAW

dataset=/VBFHToTauTau_M125_13TeV_powheg_pythia8/PhaseIFall16DR-FlatPU28to62HcalNZSRAW_90X_upgrade2017_realistic_v6_C1-v1/AODSIM

# Error when running on GluGluH125

std::bad_alloc exception

std::bad_alloc exception
----- Begin Fatal Exception 19-Jun-2017 15:37:29 CEST-----------------------
An exception of category 'BadAlloc' occurred while
   [0] Processing  Event run: 1 lumi: 847 event: 695351 stream: 3
   [1] Running path 'HLTriggerFinalPath'
   [2] Calling method for module HcalTrigPrimDigiProducer/'simHcalTriggerPrimitiveDigis'
Exception Message:
A std::bad_alloc exception was thrown.
The job has probably exhausted the virtual memory available to the process.
----- End Fatal Exception -------------------------------------------------

# basic python config files

The rerunning HLT template is used to build the initial python config files see: https://twiki.cern.ch/twiki/bin/view/CMSPublic/SWGuideGlobalHLT#Running_the_HLT_with_CMSSW_9_2_0

Specifically,
```
hltGetConfiguration /dev/CMSSW_9_2_0/HLT \
 --globaltag 92X_upgrade2017_TSG_For90XSamples_V1 \
 --path HLTriggerFirstPath,HLTriggerFinalPath,HLTAnalyzerEndpath \
 --input root://eoscms.cern.ch//eos/cms/store/mc/PhaseIFall16DR/TT_TuneCUETP8M2T4_13TeV-powheg-pythia8/GEN-SIM-RAW/FlatPU28to62HcalNZSRAW_90X_upgrade2017_realistic_v6_C1-v2/130000/BE521173-FD10-E711-A3FE-02163E0176C2.root \
 --mc --process MYHLT --full --offline \
 --l1-emulator FullMC --l1 L1Menu_Collisions2017_dev_r5_m4_patch_xml \
 --unprescale --max-events 10 --output none > hlt92X.py
```

To run the whole HLT chain, you must remove `--path HLTriggerFirstPath,HLTriggerFinalPath,HLTAnalyzerEndpath \`


# Cfg alterations
Comment out pool source
```
#process.source = cms.Source( "PoolSource",
from THRAnalysis.TauHLTStudies.tauHLTStudies import setSourceFiles
setSourceFiles( process )
```

Comment Out for crab submissions:
```
process.dqmOutput = cms.OutputModule("DQMRootOutputModule",
    fileName = cms.untracked.string("DQMIO.root")
)

process.DQMOutput = cms.EndPath( process.dqmOutput )
```

#process = customizeHLTforAll(process,"GRun",_customInfo)
process = customizeHLTforAll(process,"GRun")




# Running with Crab3

```
source setupCrab.sh
cd python
python submit_crab_mc_92X_cfg.py
```


# Triggers Studied

These are the paths from SingleMuon and Tau HLT paths with tag and probe versions:
23 June 2017

HLT_IsoMu20_eta2p1_LooseChargedIsoPFTau27_eta2p1_CrossL1_v2,
HLT_IsoMu20_eta2p1_LooseChargedIsoPFTau27_eta2p1_TightID_CrossL1_v2,
HLT_IsoMu20_eta2p1_MediumChargedIsoPFTau27_eta2p1_CrossL1_v2,
HLT_IsoMu20_eta2p1_MediumChargedIsoPFTau27_eta2p1_TightID_CrossL1_v2,
HLT_IsoMu20_eta2p1_TightChargedIsoPFTau27_eta2p1_CrossL1_v2,
HLT_IsoMu20_eta2p1_TightChargedIsoPFTau27_eta2p1_TightID_CrossL1_v2,
HLT_IsoMu20_v8,
HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau20_SingleL1_v2,
HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau20_TightID_SingleL1_v2,
HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_CrossL1_v2,
HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau35_Trk1_eta2p1_Reg_CrossL1_v2,
HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau20_SingleL1_v2,
HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau20_TightID_SingleL1_v2,
HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_CrossL1_v2,
HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau35_Trk1_eta2p1_Reg_CrossL1_v2,
HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau50_Trk30_eta2p1_1pr_v2,
HLT_IsoMu24_eta2p1_TightChargedIsoPFTau20_SingleL1_v2,
HLT_IsoMu24_eta2p1_TightChargedIsoPFTau20_TightID_SingleL1_v2,
HLT_IsoMu24_eta2p1_TightChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_CrossL1_v2,
HLT_IsoMu24_eta2p1_TightChargedIsoPFTau35_Trk1_eta2p1_Reg_CrossL1_v2,
HLT_IsoMu24_eta2p1_v8,
HLT_IsoMu24_v6,
HLT_IsoMu27_v9,
HLT_DoubleLooseChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_v2,
HLT_DoubleLooseChargedIsoPFTau35_Trk1_eta2p1_Reg_v2,
HLT_DoubleLooseChargedIsoPFTau40_Trk1_TightID_eta2p1_Reg_v2,
HLT_DoubleLooseChargedIsoPFTau40_Trk1_eta2p1_Reg_v2,
HLT_DoubleMediumChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_v2,
HLT_DoubleMediumChargedIsoPFTau35_Trk1_eta2p1_Reg_v2,
HLT_DoubleMediumChargedIsoPFTau40_Trk1_TightID_eta2p1_Reg_v2,
HLT_DoubleMediumChargedIsoPFTau40_Trk1_eta2p1_Reg_v2,
HLT_DoubleTightChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_v2,
HLT_DoubleTightChargedIsoPFTau35_Trk1_eta2p1_Reg_v2,
HLT_DoubleTightChargedIsoPFTau40_Trk1_TightID_eta2p1_Reg_v2,
HLT_DoubleTightChargedIsoPFTau40_Trk1_eta2p1_Reg_v2,

For checking WPs
HLT_IsoMu20_eta2p1_LooseChargedIsoPFTau27_eta2p1_CrossL1_v2,HLT_IsoMu20_eta2p1_LooseChargedIsoPFTau27_eta2p1_TightID_CrossL1_v2,HLT_IsoMu20_eta2p1_MediumChargedIsoPFTau27_eta2p1_CrossL1_v2,HLT_IsoMu20_eta2p1_MediumChargedIsoPFTau27_eta2p1_TightID_CrossL1_v2,HLT_IsoMu20_eta2p1_TightChargedIsoPFTau27_eta2p1_CrossL1_v2,HLT_IsoMu20_eta2p1_TightChargedIsoPFTau27_eta2p1_TightID_CrossL1_v2,HLT_IsoMu20_v8,HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau20_SingleL1_v2,HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau20_TightID_SingleL1_v2,HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau35_Trk1_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau20_SingleL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau20_TightID_SingleL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau35_Trk1_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau50_Trk30_eta2p1_1pr_v2,HLT_IsoMu24_eta2p1_TightChargedIsoPFTau20_SingleL1_v2,HLT_IsoMu24_eta2p1_TightChargedIsoPFTau20_TightID_SingleL1_v2,HLT_IsoMu24_eta2p1_TightChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_TightChargedIsoPFTau35_Trk1_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_v8,HLT_IsoMu24_v6,HLT_IsoMu27_v9,

For checking double tau trigger
HLT_DoubleLooseChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleLooseChargedIsoPFTau35_Trk1_eta2p1_Reg_v2,HLT_DoubleLooseChargedIsoPFTau40_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleLooseChargedIsoPFTau40_Trk1_eta2p1_Reg_v2,HLT_DoubleMediumChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleMediumChargedIsoPFTau35_Trk1_eta2p1_Reg_v2,HLT_DoubleMediumChargedIsoPFTau40_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleMediumChargedIsoPFTau40_Trk1_eta2p1_Reg_v2,HLT_DoubleTightChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleTightChargedIsoPFTau35_Trk1_eta2p1_Reg_v2,HLT_DoubleTightChargedIsoPFTau40_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleTightChargedIsoPFTau40_Trk1_eta2p1_Reg_v2,

Both:
HLT_IsoMu20_eta2p1_LooseChargedIsoPFTau27_eta2p1_CrossL1_v2,HLT_IsoMu20_eta2p1_LooseChargedIsoPFTau27_eta2p1_TightID_CrossL1_v2,HLT_IsoMu20_eta2p1_MediumChargedIsoPFTau27_eta2p1_CrossL1_v2,HLT_IsoMu20_eta2p1_MediumChargedIsoPFTau27_eta2p1_TightID_CrossL1_v2,HLT_IsoMu20_eta2p1_TightChargedIsoPFTau27_eta2p1_CrossL1_v2,HLT_IsoMu20_eta2p1_TightChargedIsoPFTau27_eta2p1_TightID_CrossL1_v2,HLT_IsoMu20_v8,HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau20_SingleL1_v2,HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau20_TightID_SingleL1_v2,HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_LooseChargedIsoPFTau35_Trk1_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau20_SingleL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau20_TightID_SingleL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau35_Trk1_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_MediumChargedIsoPFTau50_Trk30_eta2p1_1pr_v2,HLT_IsoMu24_eta2p1_TightChargedIsoPFTau20_SingleL1_v2,HLT_IsoMu24_eta2p1_TightChargedIsoPFTau20_TightID_SingleL1_v2,HLT_IsoMu24_eta2p1_TightChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_TightChargedIsoPFTau35_Trk1_eta2p1_Reg_CrossL1_v2,HLT_IsoMu24_eta2p1_v8,HLT_IsoMu24_v6,HLT_IsoMu27_v9,HLT_DoubleLooseChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleLooseChargedIsoPFTau35_Trk1_eta2p1_Reg_v2,HLT_DoubleLooseChargedIsoPFTau40_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleLooseChargedIsoPFTau40_Trk1_eta2p1_Reg_v2,HLT_DoubleMediumChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleMediumChargedIsoPFTau35_Trk1_eta2p1_Reg_v2,HLT_DoubleMediumChargedIsoPFTau40_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleMediumChargedIsoPFTau40_Trk1_eta2p1_Reg_v2,HLT_DoubleTightChargedIsoPFTau35_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleTightChargedIsoPFTau35_Trk1_eta2p1_Reg_v2,HLT_DoubleTightChargedIsoPFTau40_Trk1_TightID_eta2p1_Reg_v2,HLT_DoubleTightChargedIsoPFTau40_Trk1_eta2p1_Reg_v2,
